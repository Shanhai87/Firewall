FIREWALL

Установка программы firewall:

    make install

Прогнать тесты:

    make test

Посмотреть доступные команды make можно в Makefile или командой
    make help (будет видно полное описание)
Запустить программу

    ./firewall --db1

или
    ./firewall --db2

При этом загружаются правила из соответствующей базы данных
(они определены в firewall.h).
Если запустить без аргумента --db[x], то программа не будет
содержать правил, ответы на все запросы будут - drop.

Файлы баз данных находятся в каталоге database. Их несложно
изменить под свои цели, добавив или/и удалив необходимые строки
по тому же принципу как они написаны (если параметр может принимать
любое значение, то его можно пропустить). Например:

    src: 10.0.1.11      dst: 1.1.1.1    proto: tcp      => ACCEPT

определяет src_ip, dst_ip, protocol и status. Каждый параметр
должен быть определен в паре со своим ключом через пробел(ы) или таб(ы)
("src:", "dst:", "proto" и "=>").

    src:  10.0.1.11    proto:  any      =>  ACCEPT

Здесь dst_ip - любой IP, так как он не указан. Протокол любой - так как указано "any".

Доступные команды в программе:

Закрыть программу CTRL + D или:

    exit

Показать все загруженные правила:    

    show

Удалить правило номер [n]:

    delete [n] (например delete 2)

Сохранить новое правило:

    save  status  src_ip   dst_ip   src_port  dst_port  protocol

Например:

    save  accept  1.1.1.1  2.2.2.2  any  any  any

или

    save drop  192.168.10.130/25  any  2000  3000  2

Номера портов на правило не влияют.
Если указана маска подсети, то вычисляются все IP из диапаона,
включающего данный адрес (для 192.168.10.130/25 правило будет
действовать на IP от 192.168.10.128 до 192.168.10.255).

Доступные протоколы:
2 - igmp
6 - tcp
17 - udp

Несложно добавить любые другие. В заголовочных файлах (firewall.h, generator.h, utils.h) места
добавления помечены: "@warning Новые протоколы добавить здесь" (всего 5 мест).

Сделать запрос для получения ответа:

    src_ip   dst_ip   src_port  dst_port  protocol

Например:

    1.1.1.1  2.2.2.2  any  any  any

Если есть подходящее правило, то вернется его результат (accept или drop).
Если подходящего правила нет, то вернется drop.

Любая некорректная команда будет определена, затем выведется соответствующий ей текст ошибки.


ГЕНЕРАТОР.

Установка программы generator:

    make install_generator

Запустить программу:

    ./generator

В этом случае выведется сгенерированная строка, содержащая 2 рандомных ip адреса, текст
"any any" (порты не имеют значения) и номер протокола (6 или 17).

    ./generator --file

В этом случае генерируемые значения будут браться случайным образом из набора, указанного
в файле gen_settings (значения можно редактировать).
Каждое значение указывается в новой строке, можно указывать одиночный ip адрес, ip адрес с маской
и диапазон адресов через дефис:

1.1.1.1
1.1.1.1/24
1.1.1.1-1.1.10.0

Файл gen_settings содержит настройки для генерации запросов, подходящих для программы firewall, запущенной
с набором правил из db2.

Посмотреть и проверить совместную работу двух программ можно с помощью команды:

./generator --file | tee -a log.txt | ./firewall --db2 >> log.txt

generator сгенерирует строку и сохранит ее в файле log.txt, так же эта строка попадет на вход программе
firewall. В ответ на это будет получен результат (accept или drop), который тоже сохранится в файле log.txt

./generator --file | tee /dev/tty | ./firewall --db2

Эта команда сделает то же самое, но результат выведет в консоль.
Генерация новых значений происходит не чаще 1 раза в секудну. Если делать запросы быстрее, то результаты будут
повторяться.